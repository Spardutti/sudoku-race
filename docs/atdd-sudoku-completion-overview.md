# ATDD - Sudoku Completion E2E Tests

**Date:** 2025-12-12
**Author:** Spardutti (via Murat - TEA Agent)
**Primary Test Level:** E2E
**Scope:** Sudoku completion flows for guest and authenticated users

---

## Story Summary

**As a** sudoku player
**I want** to complete puzzles and see my results
**So that** I can track my performance and share my achievements

### User Flows

**Guest User:**
Start puzzle → Fill cells → Submit → See completion time + hypothetical rank → Share results

**Authenticated User:**
Start puzzle → Fill cells → Submit → See completion time + actual rank + streak → Share results

---

## Acceptance Criteria

### Guest User Flow
1. Guest user can complete a puzzle and see completion time
2. Guest user sees hypothetical rank (what rank they would have if signed in)
3. Guest user can share results via Twitter, WhatsApp, clipboard
4. Guest user sees sign-in prompt with benefits
5. Completion modal displays emoji grid visualization

### Authenticated User Flow
1. Authenticated user can complete a puzzle and see completion time
2. Authenticated user sees actual leaderboard rank
3. Authenticated user sees current streak and freeze status
4. Authenticated user can share results with streak information
5. Completion data is persisted to database with rank

---

## Failing Tests Created (RED Phase)

### Guest User Tests (8 tests)

**File:** `tests/e2e/sudoku-completion-guest.spec.ts` (195 lines)

All tests RED - missing data-testid attributes and implementation logic.

### Authenticated User Tests (8 tests)

**File:** `tests/e2e/sudoku-completion-authenticated.spec.ts` (178 lines)

All tests RED - missing auth flow, data-testids, and persistence logic.

**Total:** 16 failing tests

---

## Supporting Infrastructure

### Data Factories

**File:** `tests/support/fixtures/factories/puzzle.factory.ts`

- `createPuzzle(overrides?)` - Generate puzzle data
- `createSolvedGrid()` - Valid solved 9x9 grid
- `createSolvedGridAlt()` - Alternative solved grid

### Auth Helpers

**File:** `tests/support/helpers/auth.helper.ts`

- `signInViaUI(page, user)` - Sign in via UI
- `createTestUserViaAPI(email, password)` - Create test user
- `deleteTestUserViaAPI(userId)` - Cleanup test user

---

## Running Tests

```bash
# All completion tests
npm run test:e2e tests/e2e/sudoku-completion-guest.spec.ts tests/e2e/sudoku-completion-authenticated.spec.ts

# Guest user tests only
npm run test:e2e tests/e2e/sudoku-completion-guest.spec.ts

# Authenticated tests only
npm run test:e2e tests/e2e/sudoku-completion-authenticated.spec.ts

# Headed mode (watch browser)
npm run test:e2e:headed tests/e2e/sudoku-completion-guest.spec.ts

# Debug mode
npm run test:e2e:debug tests/e2e/sudoku-completion-guest.spec.ts
```

---

## Red-Green-Refactor Workflow

### RED Phase ✅ (Complete)

- ✅ 16 tests written and failing
- ✅ Factories and helpers created
- ✅ data-testid requirements documented
- ✅ Implementation checklist created

### GREEN Phase ⏭️ (Next)

1. Pick one failing test
2. Implement minimal code to pass
3. Run test to verify green
4. Move to next test

**Recommended order:** Guest flow → data-testids → share → auth flow → persistence

### REFACTOR Phase (After all green)

1. All tests passing
2. Review code quality
3. Extract duplications
4. Ensure tests still pass

---

## Documentation

- **Overview:** This file
- **data-testid Requirements:** `docs/atdd-sudoku-completion-testids.md`
- **Implementation Tasks:** `docs/atdd-sudoku-completion-tasks.md`
- **Test README:** `tests/README.md`

---

## Knowledge Base References

- **fixture-architecture.md** - Auto-cleanup patterns
- **data-factories.md** - Faker-based factories
- **network-first.md** - Route interception
- **test-quality.md** - Given-When-Then, atomicity
- **selector-resilience.md** - data-testid hierarchy

---

**Generated by BMad TEA Agent (Murat)** - 2025-12-12
